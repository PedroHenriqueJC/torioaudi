openapi: 3.0.0
info:
  title: API de Gest칚o de Salas e Equipamentos
  version: 1.0.0
  description: >
    API para gerenciamento de usu치rios, salas e equipamentos.  
    Algumas rotas s칚o restritas a administradores via middleware `admin`.

servers:
  - url: http://localhost:8000/api
    description: Servidor local

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Usuario:
      type: object
      properties:
        cod_usuario:
          type: integer
        nome_usuario:
          type: string
        email_usuario:
          type: string
        role_usuario:
          type: integer
          description: 0 = usu치rio comum, 1 = admin

    Sala:
      type: object
      properties:
        id:
          type: integer
        nome:
          type: string
        capacidade:
          type: integer

    Equipamento:
      type: object
      properties:
        id:
          type: integer
        nome:
          type: string
        descricao:
          type: string

paths:
  # ----------------------
  # 游릭 Rotas p칰blicas
  # ----------------------
  /register:
    post:
      tags: [Public]
      summary: Registrar usu치rio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [nome_usuario, email_usuario, senha_usuario]
              properties:
                nome_usuario: { type: string }
                email_usuario: { type: string, format: email }
                senha_usuario: { type: string, minLength: 6 }
      responses:
        '201': { description: Usu치rio registrado com sucesso }
        '403': { description: Usu치rio soft-deleted precisa falar com admin }
        '422': { description: Email j치 cadastrado }

  /login:
    post:
      tags: [Public]
      summary: Login do usu치rio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email_usuario, senha_usuario]
              properties:
                email_usuario: { type: string, format: email }
                senha_usuario: { type: string }
      responses:
        '200': { description: Login realizado com sucesso }
        '401': { description: Credenciais inv치lidas }
        '403': { description: Usu치rio desativado }

  /health:
    get:
      tags: [Public]
      summary: Healthcheck da API
      responses:
        '200':
          description: API est치 funcionando
          content:
            application/json:
              example:
                status: ok
                timestamp: 2025-09-25T14:00:00Z

  # ----------------------
  # 游댯 Rotas de usu치rio autenticado
  # ----------------------
  /logout:
    post:
      tags: [User]
      summary: Logout
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Logout realizado com sucesso }

  /me:
    get:
      tags: [User]
      summary: Dados do usu치rio autenticado
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Dados do usu치rio retornados }

  /salas:
    get:
      tags: [User]
      summary: Listar todas as salas
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Lista de salas }
    post:
      tags: [Admin]
      summary: Criar sala (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '201': { description: Sala criada com sucesso }

  /salas/{id}:
    get:
      tags: [User]
      summary: Obter detalhes da sala
      description: Retorna informa칞칫es de uma sala. Dispon칤vel para qualquer usu치rio autenticado.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Detalhes da sala retornados
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sala'

    put:
      tags: [Admin]
      summary: Atualizar sala (admin)
      description: Atualiza os dados de uma sala. Requer permiss칚o administrativa.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Sala'
      responses:
        '200': { description: Sala atualizada com sucesso }
        '403': { description: Acesso negado (somente admin) }

    delete:
      tags: [Admin]
      summary: Excluir sala (admin)
      description: Remove uma sala do sistema. Requer permiss칚o administrativa.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Sala removida com sucesso }
        '403': { description: Acesso negado (somente admin) }



  /equipamento:
    get:
      tags: [User]
      summary: Listar equipamentos
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Lista de equipamentos }
    post:
      tags: [Admin]
      summary: Criar equipamento (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '201': { description: Equipamento criado }

  /equipamento/{id}:
    get:
      tags: [User]
      summary: Obter equipamento
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Detalhes do equipamento }
    put:
      tags: [Admin]
      summary: Atualizar equipamento (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Equipamento atualizado }
    delete:
      tags: [Admin]
      summary: Excluir equipamento (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Equipamento removido }

  # ----------------------
  # 游댮 Rotas administrativas
  # ----------------------
  /usuarios:
    get:
      tags: [Admin]
      summary: Pegar usu치rios (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Lista de usu치rios }

  /usuarios/{id}:
    delete:
      tags: [Admin]
      summary: Soft delete de usu치rio (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Usu치rio desativado }

  /usuarios/{id}/restore:
    post:
      tags: [Admin]
      summary: Restaurar usu치rio (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Usu치rio reativado }
