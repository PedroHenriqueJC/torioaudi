openapi: 3.0.0
info:
  title: API de Gest칚o de Salas e Equipamentos
  version: 1.0.0
  description: >
    API para gerenciamento de usu치rios, salas e equipamentos.  
    Algumas rotas s칚o restritas a administradores via middleware `admin`.

servers:
  - url: http://localhost:8000/api
    description: Servidor local

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Usuario:
      type: object
      properties:
        cod_usuario:
          type: integer
        nome_usuario:
          type: string
        email_usuario:
          type: string
        role_usuario:
          type: integer
          description: 0 = usu치rio comum, 1 = admin

    Sala:
      type: object
      properties:
        id:
          type: integer
        nome:
          type: string
        capacidade:
          type: integer

    Equipamento:
      type: object
      properties:
        id:
          type: integer
        nome:
          type: string
        descricao:
          type: string

    Evento:
      type: object
      properties:
        cod_evento:
          type: integer
          example: 1
        evento_inicio:
          type: string
          format: date-time
          example: "2025-11-10T10:00:00"
        evento_fim:
          type: string
          format: date-time
          example: "2025-11-10T12:00:00"
        nome_evento:
          type: string
          example: "Reuni칚o de equipe"
        descricao_evento:
          type: string
          nullable: true
          example: "Discuss칚o sobre novos projetos"
        cancelado_evento:
          type: boolean
          example: false
        pre_agenda_evento:
          type: boolean
          example: false
        usuario_cod_usuario:
          type: integer
          example: 3
        sala_cod_sala:
          type: integer
          example: 2
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

paths:
  # ----------------------
  # 游릭 Rotas p칰blicas
  # ----------------------
  /register:
    post:
      tags: [Public]
      summary: Registrar usu치rio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [nome_usuario, email_usuario, senha_usuario]
              properties:
                nome_usuario: { type: string }
                email_usuario: { type: string, format: email }
                senha_usuario: { type: string, minLength: 6 }
      responses:
        '201': { description: Usu치rio registrado com sucesso }
        '403': { description: Usu치rio soft-deleted precisa falar com admin }
        '422': { description: Email j치 cadastrado }

  /login:
    post:
      tags: [Public]
      summary: Login do usu치rio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email_usuario, senha_usuario]
              properties:
                email_usuario: { type: string, format: email }
                senha_usuario: { type: string }
      responses:
        '200': { description: Login realizado com sucesso }
        '401': { description: Credenciais inv치lidas }
        '403': { description: Usu치rio desativado }

  /health:
    get:
      tags: [Public]
      summary: Healthcheck da API
      responses:
        '200':
          description: API est치 funcionando
          content:
            application/json:
              example:
                status: ok
                timestamp: 2025-09-25T14:00:00Z

  # ----------------------
  # 游댯 Rotas de usu치rio autenticado
  # ----------------------
  /logout:
    post:
      tags: [User]
      summary: Logout
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Logout realizado com sucesso }

  /me:
    get:
      tags: [User]
      summary: Dados do usu치rio autenticado
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Dados do usu치rio retornados }

  /salas:
    get:
      tags: [User]
      summary: Listar todas as salas
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Lista de salas }
    post:
      tags: [Admin]
      summary: Criar sala (admin)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome_sala:
                  type: string
                  maxLength: 255
                  example: "Laborat칩rio de Inform치tica"
                capacidade_sala:
                  type: integer
                  minimum: 1
                  example: 30
                localizacao_sala:
                  type: string
                  maxLength: 255
                  nullable: true
                  example: "Bloco B - 2췈 andar"
                descricao_sala:
                  type: string
                  maxLength: 255
                  nullable: true
                  example: "Sala equipada com computadores e projetor"
              required:
                - nome_sala
                - capacidade_sala
      responses:
        '201': { description: Sala criada com sucesso }
        '400': {description: Erro de valida칞칚o de par칙metros}

  /salas/{id}:
    get:
      tags: [User]
      summary: Obter detalhes da sala
      description: Retorna informa칞칫es de uma sala. Dispon칤vel para qualquer usu치rio autenticado.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Detalhes da sala retornados
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sala'
        '400': {description: Erro de valida칞칚o de par칙metros}

    put:
      tags: [Admin]
      summary: Atualizar sala (admin)
      description: Atualiza os dados de uma sala. Requer permiss칚o administrativa.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome_sala:
                  type: string
                  maxLength: 255
                  example: "Laborat칩rio de Inform치tica"
                capacidade_sala:
                  type: integer
                  minimum: 1
                  example: 30
                localizacao_sala:
                  type: string
                  maxLength: 255
                  nullable: true
                  example: "Bloco B - 2췈 andar"
                descricao_sala:
                  type: string
                  maxLength: 255
                  nullable: true
                  example: "Sala equipada com computadores e projetor"
              required:
                - nome_sala
                - capacidade_sala
      responses:
        '200': { description: Sala atualizada com sucesso }
        '403': { description: Acesso negado (somente admin) }
        '400': { description: Erro de valida칞칚o de par칙metros}

    delete:
      tags: [Admin]
      summary: Excluir sala (admin)
      description: Remove uma sala do sistema. Requer permiss칚o administrativa.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Sala removida com sucesso }
        '403': { description: Acesso negado (somente admin) }
        '400': { description: Erro de valida칞칚o de par칙metros}



  /equipamento:
    get:
      tags: [User]
      summary: Listar equipamentos
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Lista de equipamentos }
    post:
      tags: [Admin]
      summary: Criar equipamento (admin)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome_equipamento:
                  type: string
                  maxLength: 45
                  example: "Projetor Epson"
                descricao_equipamento:
                  type: string
                  maxLength: 255
                  nullable: true
                  example: "Projetor 4K com entrada HDMI e VGA"
                quantidade_equipamento:
                  type: integer
                  minimum: 1
                  example: 3
              required:
                - nome_equipamento
                - quantidade_equipamento
      responses:
        '201': { description: Equipamento criado }
        '400': { description: Erro de valida칞칚o de par칙metros}

  /equipamento/{id}:
    get:
      tags: [User]
      summary: Obter equipamento
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Detalhes do equipamento }
    put:
      tags: [Admin]
      summary: Atualizar equipamento (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome_equipamento:
                  type: string
                  maxLength: 45
                  example: "Projetor Epson"
                descricao_equipamento:
                  type: string
                  maxLength: 255
                  nullable: true
                  example: "Projetor 4K com entrada HDMI e VGA"
                quantidade_equipamento:
                  type: integer
                  minimum: 1
                  example: 3
              required:
                - nome_equipamento
                - quantidade_equipamento
      responses:
        '200': { description: Equipamento atualizado }
        '400': { description: Erro de valida칞칚o de par칙metros}

    delete:
      tags: [Admin]
      summary: Excluir equipamento (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Equipamento removido }
        '400': { description: Erro de valida칞칚o de par칙metros}

  /sala-equipamento/sala/{salaId}:
    get:
      summary: Listar equipamentos de uma sala
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: salaId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de equipamentos da sala
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    cod_equipamento:
                      type: integer
                      example: 2
                    nome_equipamento:
                      type: string
                      example: "Projetor"
                    quantidade_equipamento:
                      type: integer
                      example: 3
        '404':
          description: Sala n칚o encontrada

  /sala-equipamento/equipamento/{equipamentoId}:
    get:
      summary: Listar salas que possuem um equipamento
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: equipamentoId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de salas que possuem o equipamento
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    cod_sala:
                      type: integer
                      example: 5
                    nome_sala:
                      type: string
                      example: "Audit칩rio Principal"
                    quantidade_equipamento:
                      type: integer
                      example: 2
        '404':
          description: Equipamento n칚o encontrado

  /eventos:
    get:
      summary: Lista todos os eventos
      tags: [User]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de eventos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Evento'
    post:
      summary: Cria um novo evento
      tags: [User]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - evento_inicio
                - evento_fim
                - nome_evento
                - usuario_cod_usuario
                - sala_cod_sala
              properties:
                evento_inicio:
                  type: string
                  format: date-time
                evento_fim:
                  type: string
                  format: date-time
                nome_evento:
                  type: string
                descricao_evento:
                  type: string
                cancelado_evento:
                  type: boolean
                pre_agenda_evento:
                  type: boolean
                usuario_cod_usuario:
                  type: integer
                sala_cod_sala:
                  type: integer
      responses:
        '201':
          description: Evento criado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Evento criado com sucesso!
                  evento:
                    $ref: '#/components/schemas/Evento'

  /eventos/{id}:
    get:
      tags: [User]
      summary: Retorna um evento pelo ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Detalhes do evento
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Evento'
        '404':
          description: Evento n칚o encontrado
    put:
      summary: Atualiza um evento existente
      tags: [User]
      description: Somente o criador ou um administrador pode editar.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                evento_inicio:
                  type: string
                  format: date-time
                evento_fim:
                  type: string
                  format: date-time
                nome_evento:
                  type: string
                descricao_evento:
                  type: string
                cancelado_evento:
                  type: boolean
                pre_agenda_evento:
                  type: boolean
                usuario_cod_usuario:
                  type: integer
                sala_cod_sala:
                  type: integer
      responses:
        '200':
          description: Evento atualizado
        '403':
          description: Usu치rio sem permiss칚o
        '404':
          description: Evento n칚o encontrado
    delete:
      summary: Cancela um evento (soft delete)
      description: Somente o criador ou um administrador pode cancelar.  
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Evento cancelado com sucesso
        '400':
          description: Evento j치 estava cancelado
        '403':
          description: Usu치rio sem permiss칚o
        '404':
          description: Evento n칚o encontrado

  /eventos/usuario/{usuarioId}:
    get:
      summary: Lista eventos criados por um usu치rio
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: usuarioId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de eventos do usu치rio
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Evento'
        '404':
          description: Nenhum evento encontrado

  /eventos/sala/{salaId}:
    get:
      summary: Lista eventos que ocorrem em uma sala
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: salaId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de eventos da sala
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Evento'
        '404':
          description: Nenhum evento encontrado
  
  /eventos/{ano}/{mes}/{dia}:
    get:
      summary: Lista eventos que ocorrem em um dia
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: ano
          in: path
          required: true
          schema:
            type: integer
        - name: mes
          in: path
          required: true
          schema:
            type: integer
        - name: dia
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de eventos do dia
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Evento'
        '404':
          description: Nenhum evento encontrado

  # ----------------------
  # 游댮 Rotas administrativas
  # ----------------------
  /usuarios:
    get:
      tags: [Admin]
      summary: Pegar usu치rios (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Lista de usu치rios }

  /usuarios/{id}:
    delete:
      tags: [Admin]
      summary: Soft delete de usu치rio (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Usu치rio desativado }

  /usuarios/{id}/restore:
    post:
      tags: [Admin]
      summary: Restaurar usu치rio (admin)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Usu치rio reativado }

  /sala-equipamento:
    post:
      summary: Adicionar ou atualizar equipamento em uma sala
      tags: [Admin]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - sala_cod_sala
                - equipamento_cod_equipamento
                - quantidade_equipamento
              properties:
                sala_cod_sala:
                  type: integer
                  description: C칩digo da sala existente
                  example: 1
                equipamento_cod_equipamento:
                  type: integer
                  description: C칩digo do equipamento existente
                  example: 3
                quantidade_equipamento:
                  type: integer
                  minimum: 0
                  description: Quantidade do equipamento na sala
                  example: 5
      responses:
        '200':
          description: Equipamento adicionado ou atualizado com sucesso
        '400':
          description: Dados inv치lidos
        '404':
          description: Sala ou equipamento n칚o encontrado

  /sala-equipamento/{salaId}/{equipamentoId}:
    put:
      summary: Atualizar quantidade de um equipamento em uma sala
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: salaId
          in: path
          required: true
          schema:
            type: integer
        - name: equipamentoId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - quantidade_equipamento
              properties:
                quantidade_equipamento:
                  type: integer
                  minimum: 0
                  example: 10
                  description: Nova quantidade de equipamentos na sala
      responses:
        '200':
          description: Quantidade atualizada com sucesso
        '404':
          description: Sala ou equipamento n칚o 
    delete:
      summary: Remover um equipamento de uma sala
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: salaId
          in: path
          required: true
          schema:
            type: integer
        - name: equipamentoId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Equipamento removido com sucesso
        '404':
          description: Sala ou equipamento n칚o encontrado